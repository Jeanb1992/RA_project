<!DOCTYPE html>
<html lang="es">

<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Glenmark Realidad Aumentada">
  <meta charset="UTF-8">
  
  
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <title>Presentación</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
  </style>
  <script>
    // Variables globales
    window.currentScreen = 2;
    window.totalScreens = 21;

    // Variable global para controlar la animación de screen4
    let screen4AnimationPlayed = false;

    // Componente mejorado para manejar el aspect ratio de las imágenes
    AFRAME.registerComponent('auto-ratio', {
      schema: {
        width: { type: 'number', default: 1 },
        maxWidth: { type: 'number', default: 4 }
      },

      init: function () {
        const el = this.el;
        const data = this.data;

        // Obtener el ID de la imagen del atributo src
        const srcId = el.getAttribute('src');
        if (!srcId) return;

        // Remover el # del inicio del ID
        const imgId = srcId.replace('#', '');
        const imgEl = document.getElementById(imgId);

        if (imgEl) {
          // Si la imagen ya está cargada
          if (imgEl.complete) {
            this.adjustRatio(imgEl);
          } else {
            // Si la imagen aún se está cargando
            imgEl.addEventListener('load', () => {
              this.adjustRatio(imgEl);
            });
          }
        }
      },

      adjustRatio: function (imgEl) {
        const el = this.el;
        const data = this.data;

        const ratio = imgEl.naturalHeight / imgEl.naturalWidth;
        const width = Math.min(data.width, data.maxWidth);
        const height = width * ratio;

        el.setAttribute('width', width);
        el.setAttribute('height', height);

        // Log para debug
        console.log(`Ajustando imagen ${imgEl.id}:`, {
          ratio,
          width,
          height,
          naturalWidth: imgEl.naturalWidth,
          naturalHeight: imgEl.naturalHeight
        });
      }
    });

    // Componente específico para la screen4
    AFRAME.registerComponent('animation-finished', {
      init: function () {
        const el = this.el;

        // Lista de IDs de los botones que deben aparecer después de la animación
        const botonesIds = [
          'boton-biotecnologia',
          'boton-investigacion',
          'boton-operaciones-menu',
          'boton-cadena',
          'boton-vision',
          'boton-glenmark'
        ];

        // Ocultar todos los botones al inicio y remover clase clickable
        botonesIds.forEach(id => {
          const boton = document.querySelector(`#${id}`);
          if (boton) {
            boton.setAttribute('visible', false);
            boton.classList.remove('clickable');  // Remover clase clickable
            boton.setAttribute('material', {
              opacity: 0,
              transparent: true
            });
          }
        });

        el.addEventListener('animation-finished', function () {
          // Desvanecer y ocultar el modelo animado
          el.setAttribute('animation', {
            property: 'material.opacity',
            from: 1,
            to: 0,
            dur: 300,
            easing: 'easeInQuad',
            complete: function () {
              el.setAttribute('visible', false);  // Ocultar el modelo animado
            }
          });

          // Mostrar los botones con fade-in secuencial
          botonesIds.forEach((id, index) => {
            const boton = document.querySelector(`#${id}`);
            if (boton) {
              setTimeout(() => {
                boton.setAttribute('visible', true);
                boton.classList.add('clickable');  // Agregar clase clickable
                boton.emit('fade-in');
                console.log(`Mostrando botón ${id}`);
              }, index * 100 + 300);
            }
          });
        });
      }
    });

    // Modificar el componente screen-animation
    AFRAME.registerComponent('screen-animation', {
      schema: {
        modelId: { type: 'string' },
        timeScale: { type: 'number', default: 0.1 },
        loop: { type: 'string', default: 'once' }
      },

      init: function () {
        this.playAnimation = this.playAnimation.bind(this);

        // Ocultar los modelos al inicio si estamos en screen11
        if (this.el.id === 'screen11') {
          const modelIds = this.data.modelId.split(',').map(id => id.trim());
          modelIds.forEach(id => {
            const model = document.querySelector(id);
            if (model) {
              model.object3D.visible = false;
              model.classList.remove('clickable');
              model.removeAttribute('animation-mixer');
            }
          });

          // Ocultar el fondo también
          const fondoScreen11 = this.el.querySelector('#fondo-screen11');
          if (fondoScreen11) {
            fondoScreen11.object3D.visible = false;
          }
        }

        this.el.addEventListener('visible', (evt) => {
          if (this.el.getAttribute('visible')) {
            if (this.el.id === 'screen11') {
              const modelIds = this.data.modelId.split(',').map(id => id.trim());
              modelIds.forEach(id => {
                const model = document.querySelector(id);
                if (model) {
                  model.object3D.visible = true;
                  model.classList.add('clickable');
                  this.playAnimation();
                }
              });

              // Mostrar el fondo cuando la screen11 es visible
              const fondoScreen11 = this.el.querySelector('#fondo-screen11');
              if (fondoScreen11) {
                fondoScreen11.object3D.visible = true;
              }
            } else {
              this.playAnimation();
            }
          } else {
            // Si la screen se oculta y es screen11, ocultar los modelos
            if (this.el.id === 'screen11') {
              const modelIds = this.data.modelId.split(',').map(id => id.trim());
              modelIds.forEach(id => {
                const model = document.querySelector(id);
                if (model) {
                  model.object3D.visible = false;
                  model.classList.remove('clickable');
                  model.removeAttribute('animation-mixer');
                }
              });
            }
          }
        });
      },

      playAnimation: function () {
        const modelIds = this.data.modelId.split(',').map(id => id.trim());
        modelIds.forEach(id => {
          const model = document.querySelector(id);
          if (model) {
            model.setAttribute('animation-mixer', {
              clip: 'All Animations',
              timeScale: this.data.timeScale,
              loop: this.data.loop,
              clampWhenFinished: true,
              repetitions: 1
            });
          }
        });
      }
    });

    // Modificar el componente info-button
    AFRAME.registerComponent('info-button', {
      schema: {
        group: { type: 'string', default: 'info1' }
      },

      init: function() {
        const el = this.el;
        const screenEl = el.closest('[id^="screen"]');
        const isInfoButton = el.getAttribute('src') === '#recurso34' || el.getAttribute('src') === '#recurso14';
        
        if (!screenEl) return;

        const partnerId = this.data.group === 'info1' ? 
          (isInfoButton ? '#recurso33' : '#recurso34') : 
          (isInfoButton ? '#recurso18' : '#recurso14');
        
        const partnerEl = screenEl.querySelector(`[src="${partnerId}"]`);

        if (!partnerEl) return;

        // Configurar estado inicial
        if (isInfoButton) {
          el.setAttribute('material', {
            opacity: 1,
            transparent: true,
            shader: 'flat'
          });
          // Iniciar recurso33/18 con escala 0 en X
          partnerEl.setAttribute('scale', '0 1 1');
        }

        // Manejar click
        const onClick = (e) => {
          e.preventDefault();
          e.stopPropagation();
          
          if (!screenEl.getAttribute('visible')) return;
          
          if (isInfoButton) {
            // Ocultar botón info
            el.setAttribute('material', {
              opacity: 0,
              transparent: true,
              shader: 'flat'
            });
            // Mostrar info con animación de escala solo en X
            partnerEl.setAttribute('material', {
              opacity: 1,
              transparent: true,
              shader: 'flat'
            });
            partnerEl.setAttribute('animation__scale', {
              property: 'scale.x',
              from: 0,
              to: 1,
              dur: 300,
              easing: 'easeOutQuad'
            });
          } else {
            // Ocultar info con animación de escala solo en X
            el.setAttribute('animation__scale', {
              property: 'scale.x',
              from: 1,
              to: 0,
              dur: 300,
              easing: 'easeInQuad'
            });
            // Mostrar botón info
            partnerEl.setAttribute('material', {
              opacity: 1,
              transparent: true,
              shader: 'flat'
            });
          }
        };

        el.addEventListener('click', onClick);
        this.onClick = onClick;
        this.partnerEl = partnerEl;
      },

      remove: function() {
        if (this.onClick) {
          this.el.removeEventListener('click', this.onClick);
        }
      }
    });

    function setupInfoButtons(screenNumber) {
      // No agregar los botones si ya existen en la screen
      if ([3, 4, 11].includes(screenNumber)) {
        const screen = $(`#screen${screenNumber}`);
        if (screen.find('[info-button]').length === 0) {
          const infoButtonHtml = `
            <a-plane 
              src="#recurso34" 
              position="-0.5 -0.3 0" 
              auto-ratio="width: 0.07; maxWidth: 2"
              material="shader: flat; transparent: true; opacity: 1; alphaTest: 0.1" 
              class="clickable" 
              info-button 
              scale="1 1 1"></a-plane>
            <a-plane 
              src="#recurso33" 
              position="-0.28 -0.305 0" 
              auto-ratio="width: 0.5; maxWidth: 2"
              material="shader: flat; transparent: true; opacity: 1" 
              class="clickable" 
              info-button 
              scale="0 1 1"></a-plane>
          `;
          screen.prepend(infoButtonHtml);
        }
      }
    }

    function setupBackButtons(screenNumber) {
      // Agregar recurso9 (botón volver) solo en las screens específicas
      if ([12, 13, 14, 15, 16].includes(screenNumber)) {
        const screen = $(`#screen${screenNumber}`);
        if (screen.find('[src="#recurso9"]').length === 0) {
          const backButtonHtml = `
            <a-plane 
              src="#recurso9" 
              position="0.4 0.4 0.11" 
              auto-ratio="width: 0.05; maxWidth: 1"
              material="shader: flat; transparent: true; opacity: 1"
              class="clickable" 
              data-clickable="true"
              onclick="showScreen(11)"
              scale="1 1 1"></a-plane>
          `;
          screen.prepend(backButtonHtml);
        }
      }
    }

    function setupBackToMenu1Buttons(screenNumber) {
      // Agregar recurso35 (botón volver al menú1) solo en las screens específicas
      if ([5, 6, 7, 8, 9, 10].includes(screenNumber)) {
        const screen = $(`#screen${screenNumber}`);
        if (screen.find('[src="#recurso35"]').length === 0) {
          const backButtonHtml = `
            <a-plane 
              src="#recurso35" 
              position="0.4 0.4 0.1" 
              auto-ratio="width: 0.05; maxWidth: 1"
              material="shader: flat; transparent: true; opacity: 1"
              class="clickable" 
              data-clickable="true"
              onclick="showScreen(4)"
              scale="1 1 1"></a-plane>
          `;
          screen.prepend(backButtonHtml);
        }
      }
    }

    function setupInfoResources(screenNumber) {
      // Agregar recursos 14 y 18 solo en las screens específicas
      if ([19, 20].includes(screenNumber)) {
        const screen = $(`#screen${screenNumber}`);
        if (screen.find('[src="#recurso14"]').length === 0) {
          const infoResourcesHtml = `
            <a-plane 
              src="#recurso14" 
              position="-0.5 -0.4 0.11" 
              auto-ratio="width: 0.07; maxWidth: 2"
              material="shader: flat; transparent: true; opacity: 1; alphaTest: 0.1" 
              class="clickable" 
              info-button="group: info2" 
              scale="1 1 1"></a-plane>
            <a-plane 
              src="#recurso18" 
              position="-0.03 -0.4 0.11" 
              auto-ratio="width: 1; maxWidth: 2"
              material="shader: flat; transparent: true; opacity: 1; alphaTest: 0.1" 
              class="clickable" 
              info-button="group: info2" 
              scale="0 1 1"></a-plane>
          `;
          screen.prepend(infoResourcesHtml);
        }
      }
    }

    // Modificar la función showScreen
    function showScreen(screenNumber) {
      if (screenNumber >= 2 && screenNumber <= totalScreens) {
        // Ocultar screen actual
        const currentScreenEl = document.querySelector(`#screen${currentScreen}`);
        if (currentScreenEl) {
          currentScreenEl.setAttribute('visible', false);
          currentScreenEl.querySelectorAll('.clickable').forEach(el => {
            el.classList.remove('clickable');
          });
          // Remover botones info y back de la screen actual
          $(currentScreenEl).find('[info-button], [src="#recurso9"], [src="#recurso35"], [src="#recurso14"], [src="#recurso18"]').remove();
        }

        // Mostrar nueva screen
        const nextScreenEl = document.querySelector(`#screen${screenNumber}`);
        if (nextScreenEl) {
          nextScreenEl.setAttribute('visible', true);
          setupInfoButtons(screenNumber);
          setupBackButtons(screenNumber);
          setupBackToMenu1Buttons(screenNumber);
          setupInfoResources(screenNumber);
          nextScreenEl.querySelectorAll('[data-clickable="true"]').forEach(el => {
            el.classList.add('clickable');
          });
          nextScreenEl.dispatchEvent(new CustomEvent('visible'));
          currentScreen = screenNumber;
        }
      }
    }

    // Mover los event listeners de navegación fuera de setupClickableElements
    const setupNavigationButtons = () => {
      // Usar delegación de eventos para los botones de navegación
      document.addEventListener('click', function(e) {
        if (e.target.matches('#prev-button, #prev-button *')) {
          e.preventDefault();
          e.stopPropagation();
          if (currentScreen > 2) {
            showScreen(currentScreen - 1);
          }
        }
        if (e.target.matches('#next-button, #next-button *')) {
          e.preventDefault();
          e.stopPropagation();
          if (currentScreen < totalScreens) {
            showScreen(currentScreen + 1);
          }
        }
      });
    };

    document.addEventListener("DOMContentLoaded", function() {
      const sceneEl = document.querySelector('a-scene');
      let arSystem;
      let targetFound = false;
      
      sceneEl.addEventListener('loaded', function () {
        arSystem = sceneEl.systems["mindar-image-system"];
      });

      // Manejar eventos de AR
      sceneEl.addEventListener("arReady", (event) => {
        console.log("AR está listo");
      });

      // Configurar target
      const exampleTarget = document.querySelector('#example-target');
      exampleTarget.addEventListener("targetFound", event => {
        console.log("target encontrado");
        if (!targetFound) {
          document.querySelector('#presentation').setAttribute('visible', true);
          targetFound = true;
        }
      });

      // Registrar Service Worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('ServiceWorker registrado');
            })
            .catch(error => {
              console.log('Error al registrar ServiceWorker:', error);
            });
        });
      }
    });

    // Agregar este nuevo componente antes del screen-animation
    AFRAME.registerComponent('grafico-controller', {
      init: function() {
        if (!window.graficoAnimationPlayed) {
          window.graficoAnimationPlayed = false;
        }
        
        const screen17 = document.querySelector('#screen17');
        screen17.addEventListener('componentchanged', (evt) => {
          if (evt.detail.name === 'visible') {
            if (screen17.getAttribute('visible') && !window.graficoAnimationPlayed) {
              console.log('Iniciando animación del gráfico');
              this.el.setAttribute('animation-mixer', {
                clampWhenFinished: true,
                timeScale: 2.0,
                loop: 'once',
                repetitions: 1
              });
              window.graficoAnimationPlayed = true;
            }
          }
        });
      }
    });
  </script>
</head>

<body>
  <a-scene mindar-image="imageTargetSrc: ./assets/markers/targets.mind; 
    filterMinCF: 0.0001; 
    filterBeta: 10;
    warmupTolerance: 10;
    missTolerance: 10;
    trackingMethod: 'smooth';
    smoothCount: 10;
    smoothTolerance: 0.01;
    smoothThreshold: 5;
    keepLostTargets: true" 
    color-space="sRGB" 
    renderer="colorManagement: true, physicallyCorrectLights" 
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false">
    <a-assets>
      <img id="card" src="./img/TARJETA.jpg" />
      <img id="recurso1" src="./img/Recurso (1).png" />
      <img id="recurso2" src="./img/Recurso (2).png" />
      <img id="recurso3" src="./img/Recurso (3).png" />
      <img id="recurso4" src="./img/Recurso (4).png" />
      <img id="recurso5" src="./img/Recurso (5).png" />
      <img id="recurso6" src="./img/Recurso (6).png" />
      <img id="recurso7" src="./img/Recurso (7).png" />
      <img id="recurso8" src="./img/Recurso (8).png" />
      <img id="recurso9" src="./img/Recurso (9).png" />
      <img id="recurso10" src="./img/Recurso (10).png" />
      <img id="recurso11" src="./img/Recurso (11).png" />
      <img id="recurso12" src="./img/Recurso (12).png" />
      <img id="recurso13" src="./img/Recurso (13).png" />
      <img id="recurso14" src="./img/Recurso (14).png" />
      <img id="recurso15" src="./img/Recurso (15).png" />
      <img id="recurso16" src="./img/Recurso (16).png" />
      
      <img id="recurso18" src="./img/Recurso (18).png" />
      <img id="recurso19" src="./img/Recurso (19).png" />
      <img id="recurso20" src="./img/Recurso (20).png" />
      <img id="recurso21" src="./img/Recurso (21).png" />
      <img id="recurso22" src="./img/Recurso (22).png" />
      <img id="recurso23" src="./img/Recurso (23).png" />
      <img id="recurso24" src="./img/Recurso (24).png" />
      <img id="recurso25" src="./img/Recurso (25).png" />
      <img id="recurso26" src="./img/Recurso (26).png" />
      <img id="recurso27" src="./img/Recurso (27).png" />
      <img id="recurso28" src="./img/Recurso (28).png" />
      <img id="recurso29" src="./img/Recurso (29).png" />
      <img id="recurso30" src="./img/Recurso (30).png" />
      <img id="recurso31" src="./img/Recurso (31).png" />
      <img id="recurso32" src="./img/Recurso (32).png" />
      <img id="recurso33" src="./img/Recurso (33).png" />
      <img id="recurso34" src="./img/Recurso (34).png" />
      <img id="recurso35" src="./img/Recurso (35).png" />
      <img id="recurso36" src="./img/Recurso (36).png" />
      <img id="recurso37" src="./img/Recurso (37).png" />
      <img id="recurso38" src="./img/Recurso (38).png" />
      <img id="recurso39" src="./img/Recurso (39).png" />
      <img id="recurso40" src="./img/Recurso (40).png" />
      <img id="recurso41" src="./img/Recurso (41).png" />
      <img id="recurso42" src="./img/Recurso (42).png" />
      <img id="recurso43" src="./img/Recurso (43).png" />

      <a-asset-item id="boton-biotecnologia-animacion"
        src="./assets/3d/archivos gltf/boton-biotecnologia-animacion.gltf"></a-asset-item>
      <a-asset-item id="boton-biotecnologia-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-biotecnologia-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-biotecnologia-estatico"
        src="./assets/3d/archivos gltf/boton-biotecnologia-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-cadena-animacion" src="./assets/3d/archivos gltf/boton-cadena-animacion.gltf"
        response-type="arraybuffer"></a-asset-item>
      <a-asset-item id="boton-cadena-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-cadena-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-cadena-estatico"
        src="./assets/3d/archivos gltf/boton-cadena-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-engranaje-investigacion-animacion"
        src="./assets/3d/archivos gltf/boton-engranaje-investigacion-animacion.gltf"></a-asset-item>
      <a-asset-item id="boton-engranaje-investigacion-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-engranaje-investigacion-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-engranaje-investigacion-estatico"
        src="./assets/3d/archivos gltf/boton-engranaje-investigacion-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-engranaje-microscopio-animacion"
        src="./assets/3d/archivos gltf/boton-engranaje-microscopio-animacion.gltf"></a-asset-item>
      <a-asset-item id="boton-engranaje-microscopio-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-engranaje-microscopio-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-engranaje-microscopio-estatico"
        src="./assets/3d/archivos gltf/boton-engranaje-microscopio-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-engranaje-pharma-animacion"
        src="./assets/3d/archivos gltf/boton-engranaje-pharma-animacion.gltf"></a-asset-item>
      <a-asset-item id="boton-engranaje-pharma-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-engranaje-pharma-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-engranaje-pharma-estatico"
        src="./assets/3d/archivos gltf/boton-engranaje-pharma-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-esfera-investigacion-animacion"
        src="./assets/3d/archivos gltf/boton-esfera-investigacion-animacion.gltf"></a-asset-item>
      <a-asset-item id="boton-esfera-investigacion-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-esfera-investigacion-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-esfera-investigacion-estatico"
        src="./assets/3d/archivos gltf/boton-esfera-investigacion-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-esfera-plantas-animacion"
        src="./assets/3d/archivos gltf/boton-esfera-plantas-animacion.gltf"></a-asset-item>
      <a-asset-item id="boton-esfera-plantas-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-esfera-plantas-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-esfera-plantas-estatico"
        src="./assets/3d/archivos gltf/boton-esfera-plantas-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-glenmark-animacion"
        src="./assets/3d/archivos gltf/boton-glenmark-animacion.gltf"></a-asset-item>
      <a-asset-item id="boton-glenmark-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-glenmark-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-glenmark-estatico"
        src="./assets/3d/archivos gltf/boton-glenmark-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-investigacion-animacion"
        src="./assets/3d/archivos gltf/boton-investigacion-animacion.gltf"></a-asset-item>
      <a-asset-item id="boton-investigacion-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-investigacion-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-investigacion-estatico"
        src="./assets/3d/archivos gltf/boton-investigacion-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-operaciones-animacion"
        src="./assets/3d/archivos gltf/boton-operaciones-animacion.gltf"></a-asset-item>
      <a-asset-item id="boton-operaciones-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-operaciones-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-operaciones-estatico"
        src="./assets/3d/archivos gltf/boton-operaciones-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-vision-animacion"
        src="./assets/3d/archivos gltf/boton-vision-animacion.gltf"></a-asset-item>
      <a-asset-item id="boton-vision-desplegado-estatico"
        src="./assets/3d/archivos gltf/boton-vision-desplegado-estatico.gltf"></a-asset-item>
      <a-asset-item id="boton-vision-estatico"
        src="./assets/3d/archivos gltf/boton-vision-estatico.gltf"></a-asset-item>
      <a-asset-item id="caja-100" src="./assets/3d/archivos gltf/caja-100.gltf"></a-asset-item>
      <a-asset-item id="caja-150" src="./assets/3d/archivos gltf/caja-150.gltf"></a-asset-item>
      <a-asset-item id="cajas" src="./assets/3d/archivos gltf/cajas.gltf"></a-asset-item>
      <a-asset-item id="esfera-inicial-estatica"
        src="./assets/3d/archivos gltf/esfera-inicial-estatica.gltf"></a-asset-item>
      <a-asset-item id="esfera-menu-estatica" src="./assets/3d/archivos gltf/esfera-menu-estatica.gltf"></a-asset-item>
      <a-asset-item id="grafico-barras-animado"
        src="./assets/3d/archivos gltf/grafico-barras-animado.gltf"></a-asset-item>
      <a-asset-item id="grafico-barras-estaticas"
        src="./assets/3d/archivos gltf/grafico-barras-estaticas.gltf"></a-asset-item>
      <a-asset-item id="mapa-animado" src="./assets/3d/archivos gltf/mapa-animado.gltf"></a-asset-item>
      <a-asset-item id="mapa-estatico" src="./assets/3d/archivos gltf/mapa-estatico.gltf"></a-asset-item>
      <a-asset-item id="mapa" src="./assets/3d/archivos gltf/mapa.gltf"></a-asset-item>
      <a-asset-item id="menu-inicial-animacion"
        src="./assets/3d/archivos gltf/menu-inicial-animacion.gltf"></a-asset-item>
      <a-asset-item id="menu-inicial-estatico"
        src="./assets/3d/archivos gltf/menu-inicial-estatico.gltf"></a-asset-item>
      <a-asset-item id="menu2-animacion" src="./assets/3d/archivos gltf/menu2-animacion.gltf"></a-asset-item>
      <a-asset-item id="esfera_inicio" src="./assets/3d/archivos gltf/esfera-inicio.gltf"></a-asset-item>
    </a-assets>

    <a-camera position="0 1.5 0" rotation="-15 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="far: 10000; objects: .clickable">
    </a-camera>

    <a-entity id="example-target" mindar-image-target="targetIndex: 0">
      <!-- Plano blanco de fondo para toda la presentación -->
      <a-plane color="white" position="0.05 -0.45 -1" width="1.5" height="1.2" material="shader: flat; opacity: 0.7" scale="1.5 1.5 1.5" geometry="">
      </a-plane>

      <a-entity id="presentation" position="0 -0.5 -0.5" scale="1.5 1.5 1.5">
        <a-entity id="nav-buttons" position="0 -0.7 0.1">
          <a-plane 
            id="prev-button"
            src="#recurso20" 
            position="0.3 0.22 0" 
            auto-ratio="width: 0.12; maxWidth: 1"
            material="shader: flat; transparent: true; opacity: 1; alphaTest: 0.1" 
            class="clickable"
            scale="0.5 0.5 0.5"
            data-clickable="true"></a-plane>
          <a-plane 
            id="next-button"
            src="#recurso36" 
            position="0.45 0.22 0" 
            auto-ratio="width: 0.12; maxWidth: 1"
            material="shader: flat; transparent: true; opacity: 1; alphaTest: 0.1" 
            class="clickable"
            scale="0.5 0.5 0.5"
            data-clickable="true"></a-plane>
        </a-entity>

        <a-entity id="screen2" visible="true">
          <a-entity gltf-model="#esfera_inicio" position="-0.3 -0.35 0.1" scale="3 3 3" class="clickable"
            id="esfera-inicio-boton"></a-entity>
          <a-plane src="#recurso37" 
            position="0 0 0" 
            auto-ratio="width: 1; maxWidth: 4" 
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen3" visible="false">
          <a-entity gltf-model="#esfera-inicial-estatica" position="-0.4 -0.14 0" scale="3 3 3"></a-entity>
          <a-plane src="#recurso38" 
            position="0 0 0" 
            auto-ratio="width: 1; maxWidth: 4" 
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen4" visible="false" screen-animation="modelId: #menu-animado; timeScale: 0.1">
          <a-entity id="menu-animado" gltf-model="#menu-inicial-animacion" position="-0.4 -0.14 0" scale="3 3 3"
            animation-finished class="animated-model"></a-entity>
          <a-entity gltf-model="#boton-biotecnologia-desplegado-estatico" position="-0.18 0.07 0" scale="1.8 1.8 1.8"
            class="clickable" visible="true" material="opacity: 0; transparent: true" id="boton-biotecnologia"></a-entity>
          <a-entity id="boton-investigacion" gltf-model="#boton-investigacion-desplegado-estatico"
            position="-0.14 -0.03 0" scale="1.8 1.8 1.8" class="clickable" visible="false"
            material="opacity: 0; transparent: true"></a-entity>
          <a-entity id="boton-operaciones-menu" gltf-model="#boton-operaciones-desplegado-estatico"
            position="-0.2 -0.125 0" scale="1.8 1.8 1.8" class="clickable" visible="false"
            material="shader: flat; opacity: 0; transparent: true"
            animation__fadeIn="property: material.opacity; from: 0; to: 1; dur: 500; startEvents: fade-in"></a-entity>
          <a-entity gltf-model="#boton-cadena-desplegado-estatico" position="-0.31 -0.1 0" scale="1.8 1.8 1.8"
            class="clickable" visible="true" material="opacity: 0; transparent: true" id="boton-cadena"></a-entity>
          <a-entity gltf-model="#boton-vision-desplegado-estatico" position="-0.33 0 0" scale="1.8 1.8 1.8"
            class="clickable" visible="true" material="opacity: 0; transparent: true" id="boton-vision"></a-entity>
          <a-entity gltf-model="#boton-glenmark-desplegado-estatico" position="-0.27 0.09 0" scale="1.8 1.8 1.8"
            class="clickable" visible="true" material="opacity: 0; transparent: true" id="boton-glenmark"></a-entity>
          <a-plane src="#recurso29" 
            position="0 0.17 0.09" 
            auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="0.5 0.5 0.5"></a-plane>
        </a-entity>
        <a-entity id="screen5" visible="false" screen-animation="modelId: #glenmark-animado; timeScale: 0.1">
          <a-entity id="glenmark-animado" gltf-model="#boton-glenmark-animacion" position="-0.8 -0.5 0.1" scale="5 5 5"
            animation-mixer></a-entity>
          <a-plane src="#recurso26" 
            position="0 0 0" 
            auto-ratio="width: 1; maxWidth: 4" 
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen6" visible="false" screen-animation="modelId: #vision-animado; timeScale: 0.1">
          <a-entity id="vision-animado" gltf-model="#boton-vision-animacion" position="-0.55 -0.4 0.11" scale="5 5 5"
            animation-mixer></a-entity>
          <a-plane src="#recurso25" 
            position="0 0 0" 
            auto-ratio="width: 1; maxWidth: 4" 
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen7" visible="false"
          screen-animation="modelId: #biotecnologia-animado; timeScale: 0.1; loop: none">
          <a-entity id="biotecnologia-animado" gltf-model="#boton-biotecnologia-animacion" position="-0.75 -0.5 0.1"
            scale="5 5 5" animation-mixer="clampWhenFinished: true; repetitions: 1" class="animated-model"></a-entity>
          <a-plane src="#recurso41" 
            position="0 0 0" 
            auto-ratio="width: 1; maxWidth: 4" 
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen8" visible="false" screen-animation="modelId: #cadena-animado; timeScale: 0.1; loop: none">
          <a-entity id="cadena-animado" gltf-model="#boton-cadena-animacion" position="-0.6 -0.43 0.1" scale="5 5 5"
            animation-mixer="clampWhenFinished: true; repetitions: 1" class="animated-model"></a-entity>
          <a-plane src="#recurso23" 
            position="0.1 0.03 0" 
            auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.09  " 
            scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen9" visible="false"
          screen-animation="modelId: #investigacion-animado; timeScale: 0.1; loop: none">
          <a-entity id="investigacion-animado" gltf-model="#boton-investigacion-animacion" position="-0.8 -0.45 0.1"
            scale="5 5 5" animation-mixer="clampWhenFinished: true; repetitions: 1" class="animated-model"></a-entity>
          <a-plane src="#recurso24" position="0 0 0" auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.09" scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen10" visible="false"
          screen-animation="modelId: #operaciones-animado, #mapa-animado; timeScale: 0.1; loop: none">
          <a-entity id="operaciones-animado" gltf-model="#boton-operaciones-animacion" position="-0.67 -0.36 0.1"
            scale="5 5 5" animation-mixer="clampWhenFinished: true; repetitions: 1" class="animated-model"></a-entity>
          <a-entity id="mapa-animado" gltf-model="#mapa-animado" position="-0.3 0.45 0" scale="2 2 2" rotation="80 0 0"
            animation-mixer="clampWhenFinished: true; repetitions: 1" class="animated-model"></a-entity>
          <a-plane src="#recurso27" position="0 0.05 0" auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.09" scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen11"
          screen-animation="modelId: #esfera-plantas-animado, #engranaje-pharma-animado, #esfera-investigacion-animado, #engranaje-investigacion-animado, #engranaje-microscopio-animado; timeScale: 0.1; loop: none">
          <a-entity id="esfera-plantas-animado" gltf-model="#boton-esfera-plantas-animacion" position="-0.42 -0.3 0.1"
            scale="3 3 3" class="clickable" rotation="0 10 0"
            animation-mixer="clampWhenFinished: true; repetitions: 1"></a-entity>
          <a-entity id="engranaje-pharma-animado" gltf-model="#boton-engranaje-pharma-animacion" position="-0.3 -0.3 0.1"
            scale="3 3 3" class="clickable" animation-mixer="clampWhenFinished: true; repetitions: 1"></a-entity>
          <a-entity id="esfera-investigacion-animado" gltf-model="#boton-esfera-investigacion-animacion"
            position="-0.2 -0.25 0.1" scale="2.5 2.5 2.5" class="clickable"
            animation-mixer="clampWhenFinished: true; repetitions: 1"></a-entity>
          <a-entity id="engranaje-investigacion-animado" gltf-model="#boton-engranaje-investigacion-animacion"
            position="-0.32 -0.32 0.1" scale="3 3 3" class="clickable"
            animation-mixer="clampWhenFinished: true; repetitions: 1"></a-entity>
          <a-entity id="engranaje-microscopio-animado" gltf-model="#boton-engranaje-microscopio-animacion"
            position="-0.3 -0.32 0.1" scale="3 3 3" class="clickable"
            animation-mixer="clampWhenFinished: true; repetitions: 1"></a-entity>
          <a-plane id="fondo-screen11" src="#recurso21" position="0 -0.1 0" auto-ratio="width: 1.2; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" scale="1 1 1" visible="false"></a-plane>
        </a-entity>
        <a-entity id="screen12" visible="false">
          <a-entity gltf-model="#boton-esfera-plantas-desplegado-estatico" position="-0.57 -0.32 0.2" rotation="0 20 0"
            scale="3.7 3.7 3.7"></a-entity>
          <a-plane src="#recurso32" position="-0.1 0.12 0.1" auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen13" visible="false">
          <a-entity gltf-model="#boton-esfera-investigacion-desplegado-estatico" position="-0.3 -0.2 0.1" scale="3 3 3"
            rotation="0 0 0"></a-entity>
          <a-plane src="#recurso4" position="-0.03 -0.1 0.1" auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen14" visible="false">
          <a-entity gltf-model="#boton-engranaje-investigacion-desplegado-estatico" position="-0.55 -0.25 0.1"
            scale="3 3 3"></a-entity>
          <a-plane src="#recurso5" position="0 0 0.1" auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen15" visible="false">
          <a-entity gltf-model="#boton-engranaje-pharma-desplegado-estatico" position="-0.4 -0.35 0.1"
            scale="3 3 3"></a-entity>
          <a-plane src="#recurso6" position="0 0 0.1" auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen16" visible="false">
          <a-entity gltf-model="#boton-engranaje-microscopio-desplegado-estatico" position="-0.3 -0.21 0.1"
            scale="3 3 3"></a-entity>
          <a-plane src="#recurso7" position="0 0 0.1" auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen17" visible="false" screen-animation="modelId: #grafico-animado; timeScale: 1.0; loop: none">
          <a-entity id="grafico-animado" 
            gltf-model="#grafico-barras-animado" 
            position="-0.46 -0.4 0.35" 
            scale="4 4 4"
            rotation="0 45 0" 
            grafico-controller>
          </a-entity>
         
          <a-plane src="#recurso13" 
            position="0 0 0.1" 
            auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen18" visible="false">
          <a-plane src="#recurso22" 
            position="0 0 0.1" 
            auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen19" visible="false">
          <a-plane 
            src="#recurso28" 
            position="0.28 -0.03 0.4" 
            auto-ratio="width: 0.1; maxWidth: 4"
            material="shader: flat; transparent: true; opacity: 1; alphaTest: 0.99" 
            scale="1 1 1"></a-plane>
          <a-entity gltf-model="#cajas" position="-0.33 -0.3 -0.3" scale="2.8 2.8 2.8" rotation="0 0 0"></a-entity>
          <a-plane src="#recurso15" 
            position="0 0 0.1" 
            auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen20" visible="false">
          <a-plane 
            src="#recurso28" 
            position="0.28 -0.03 0.4" 
            auto-ratio="width: 0.1; maxWidth: 4"
            material="shader: flat; transparent: true; opacity: 1; alphaTest: 0.99" 
            scale="1 1 1"></a-plane>
          <a-entity gltf-model="#cajas" position="-0.33 -0.3 -0.3" scale="2.8 2.8 2.8" rotation="0 0 0"></a-entity>
          <a-plane src="#recurso16" 
            position="0 0 0.1" 
            auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="1 1 1"></a-plane>
        </a-entity>
        <a-entity id="screen21" visible="false">
          <a-plane src="#recurso19" 
            position="0 0 0.1" 
            auto-ratio="width: 1; maxWidth: 4"
            material="shader: flat; transparent: true; alphaTest: 0.1" 
            scale="1 1 1"></a-plane>
        </a-entity>
      </a-entity>
    </a-entity>
  </a-scene>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let currentScreen = 2;
      const totalScreens = 21;

      // Definir los menús
      const menu1 = {
        buttons: {
          'boton-biotecnologia': 7,
          'boton-investigacion': 9,
          'boton-operaciones-menu': 10,
          'boton-cadena': 8,
          'boton-vision': 6,
          'boton-glenmark': 5
        }
      };

      const menu2 = {
        buttons: {
          'esfera-plantas-animado': 12,
          'engranaje-pharma-animado': 15,
          'esfera-investigacion-animado': 13,
          'engranaje-investigacion-animado': 14,
          'engranaje-microscopio-animado': 16
        }
      };

      // Configurar todos los elementos clickeables
      function setupClickableElements() {
        // Configurar botones de menú 1
        Object.entries(menu1.buttons).forEach(([id, targetScreen]) => {
          const button = document.querySelector(`#${id}`);
          if (button) {
            button.setAttribute('data-clickable', 'true');
            button.addEventListener('click', (e) => {
              e.preventDefault();
              e.stopPropagation();
              console.log(`Click en ${id}, navegando a screen ${targetScreen}`);
              const parentScreen = button.closest('[id^="screen"]');
              if (parentScreen && parentScreen.getAttribute('visible')) {
                showScreen(targetScreen);
              }
            });
          }
        });

        // Configurar botones de menú 2 (similar al menú 1)
        Object.entries(menu2.buttons).forEach(([id, targetScreen]) => {
          const button = document.querySelector(`#${id}`);
          if (button) {
            button.setAttribute('data-clickable', 'true');
            button.addEventListener('click', (e) => {
              e.preventDefault();
              e.stopPropagation();
              console.log(`Click en ${id}, navegando a screen ${targetScreen}`);
              const parentScreen = button.closest('[id^="screen"]');
              if (parentScreen && parentScreen.getAttribute('visible')) {
                showScreen(targetScreen);
              }
            });
          }
        });

        // Configurar botón de inicio
        const esferaInicio = document.querySelector('#esfera-inicio-boton');
        if (esferaInicio) {
          esferaInicio.setAttribute('data-clickable', 'true');
          esferaInicio.addEventListener('click', () => showScreen(3));
        }

        // Configurar botones de volver
        document.querySelectorAll('#boton-volver-menu1').forEach(button => {
          button.setAttribute('data-clickable', 'true');
          button.addEventListener('click', () => showScreen(4));
        });

        // Configurar recurso9
        document.querySelectorAll('[src="#recurso9"]').forEach(button => {
          button.setAttribute('data-clickable', 'true');
          button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const parentScreen = this.closest('[id^="screen"]');
            if (parentScreen && parentScreen.getAttribute('visible')) {
              showScreen(11); // Siempre ir al menú2 (screen11)
            }
          });
        });
      }

      // Inicializar todo
      const scene = document.querySelector('a-scene');
      if (scene.hasLoaded) {
        setupClickableElements();
        setupInfoResources();
        setupNavigationButtons();
      } else {
        scene.addEventListener('loaded', () => {
          setupClickableElements();
          setupInfoResources();
          setupNavigationButtons();
        });
      }
    });
  </script>
</body>

</html>